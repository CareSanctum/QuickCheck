name: Build and Submit to Android Play Store

on:
    workflow_dispatch:
        inputs:
            channel:
                type: choice
                description: Build Profile to use
                options:
                    - staging
                    - production
                required: true

jobs:
    BuildAndSubmit:
        if: github.repository == 'CareSanctum/QuickCheck'
        name: Build and Submit to Android Play Store
        runs-on: ubuntu-latest
        steps:
            - name: Check for EXPO token
              env: 
                EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
              run: bash scripts/check-expo-token.sh

            - name: Checkout
              uses: actions/checkout@v4
              with:
                fetch-depth: 0
            
            - name: Setup Node
              uses: actions/setup-node@v4
              with:
                node-version-file: .nvmrc
                cache: 'npm'

            - name: Setup EAS
              uses: expo/expo-github-action@main
              with:
                eas-version: latest
                token: ${{ secrets.EXPO_TOKEN }}
                packager: 'npm'

            - name: Install Dependencies
              run: npm ci 

            - name: Build Android App
              #run: eas build --platform android --profile ${{ inputs.channel || 'staging'}}
              run: echo "Created Android App"
              
            - name: Upload Android App artifacts
              if: ${{ inputs.channel != 'production' }}
              run: echo "Uploading Android App artifacts"
              #uses: actions/upload-artifact@v4
              
            - name: Submit to Android Play Store
              if: ${{ inputs.channel == 'production' }}
              #run: eas submit --platform android --profile production
              run: echo "Submitting to Android Play Store"
              